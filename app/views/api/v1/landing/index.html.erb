<div class="container-fluid">
  <div class="row justify-content-end">
    <div class="col-5" style="text-align: right">
      <%= link_to 'Control Panel', admin_root_path %> |
      <%= link_to 'Public Website', root_path %>
    </div>
  </div>
</div>

<h1><%= Option::string(Option::Keys::WEBSITE_NAME) %>
  HTTP API <small>version 1</small></h1>

<section id="table-of-contents">
  <ul>
    <li><a href="#basic-info">Basic Information</a></li>
    <li>
      Items
      <ul>
        <li><a href="#create-item">Create or update an item</a></li>
      </ul>
    </li>
    <li>
      Elements
      <ul>
        <li><a href="#list-elements">List elements</a></li>
      </ul>
    </li>
  </ul>
</section>

<section id="basic-info">
  <h2>Basic Information</h2>
  <ul>
    <li>All request and response entities should be in JSON format and
      accompanied by a <code>Content-Type: application/json</code> header.</li>
    <li>All requests require HTTP Basic authentication. The username is that
      of the <%= link_to 'Control Panel user', admin_users_path %> and the
      secret is their API key.</li>
    <li>In addition to the documented response statuses, clients should be
      prepared to handle 500-level errors in response to any request.</li>
  </ul>
</section>

<h2>Items</h2>

<h3 id="create-item">Create or update an item</h3>

<table class="table">
  <tr>
    <td>Request Method</td>
    <td><code>PUT</code></td>
  </tr>
  <tr>
    <td>Request Content Type</td>
    <td><code>application/json</code></td>
  </tr>
  <tr>
    <td>Request Entity</td>
    <td><code class="code-block">{
    "class": "Item",
    "id": "local-item-id",
    "media_type": "image/jp2",
    "service_key": "service-key",
    "source_id": "some-item",
    "source_uri": "http://example.org/some-item",
    "full_text": "The quick brown fox jumped over the lazy dog."
    "access_image_uri": "http://example.org/some-item/image.jp2",
    "elements" : [
        {
            "name": "some-element-name",
            "value": "some element value"
        },
        {
            "name": "some-element-name",
            "value": "some element value"
        }
        ... more elements
    ]
}</code>

      <p class="text-info">
        <i class="fas fa-info-circle"></i>
        Unrecognized keys will be silently discarded.
      </p>

      <table class="table table-condensed">
        <tr>
          <th></th>
          <th>Required</th>
          <th>Description</th>
        </tr>
        <tr>
          <td><code>access_image_uri</code></td>
          <td>No</td>
          <td>URI of a high-quality image representing the item.</td>
        </tr>
        <tr>
          <td><code>class</code></td>
          <td>Yes</td>
          <td>
            One of the following:
            <%=raw Item::Variants::all.sort.map{ |v| "<code>#{v}</code>" }.join(', ') %>
          </td>
        </tr>
        <tr>
          <td><code>elements</code></td>
          <td>No</td>
          <td>Element names are arbitrary and can be mapped to local names via
            the <%= link_to 'Control Panel', admin_root_path %>. At a minimum,
            <code>title</code> should be provided, if possible.
            <p class="text-info">
              <i class="fas fa-info-circle"></i>
              Elements that map to date-type local elements will be parsed and
              stored as dates. If the parsing fails, they will be silently discarded.
              For best compatibility, provide full ISO-8601 dates.
            </p>
          </td>
        </tr>
        <tr>
          <td><code>full_text</code></td>
          <td>No</td>
          <td>Free-form string of unlimited length.</td>
        </tr>
        <tr>
          <td><code>id</code></td>
          <td>Yes</td>
          <td>Must be unique across all items in the harvesting application,
            and should be stable from harvest to harvest.</td>
        </tr>
        <tr>
          <td><code>media_type</code></td>
          <td>No</td>
          <td>A recognized media a.k.a. MIME type. Should be a specific type and
            not something generic like <code>application/octet-stream</code>
            (unless the represented data really is an unspecified binary format).
            May or may not be the type of <code>access_image_uri</code>.
            May be omitted if unknown or not applicable.
          </td>
        </tr>
        <tr>
          <td><code>service_key</code></td>
          <td>Yes</td>
          <td>Must be one of the available
            <%= link_to 'content service', admin_content_services_path %> keys.
          </td>
        </tr>
        <tr>
          <td><code>source_id</code></td>
          <td>Yes</td>
          <td>Identifier of the item in the source service.</td>
        </tr>
        <tr>
          <td><code>source_uri</code></td>
          <td>Yes</td>
          <td>URI of the item's main public human-consumable representation.
            If it has an <code>example.org</code> domain, the item will be
            silently discarded.</td>
        </tr>
      </table>
    </td>
  </tr>
  <tr>
    <td>URI Path</td>
    <td><code>/api/<%= @version_path_component %>/items/:id</code></td>
  </tr>
  <tr>
    <td>Query Arguments</td>
    <td></td>
  </tr>
  <tr>
    <td>Response Status</td>
    <td>
      <ul>
        <li><code>204 No Content</code> upon success</li>
        <li><code>400 Bad Request</code> upon illegal argument</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td>Response Entity</td>
    <td>None</td>
  </tr>
</table>

<h2>Elements</h2>

<h3 id="list-elements">List elements</h3>

<table class="table">
  <tr>
    <td>Request Method</td>
    <td><code>GET</code></td>
  </tr>
  <tr>
    <td>Request Content Type</td>
    <td></td>
  </tr>
  <tr>
    <td>Request Entity</td>
    <td></td>
  </tr>
  <tr>
    <td>URI Path</td>
    <td><code>/api/<%= @version_path_component %>/elements</code></td>
  </tr>
  <tr>
    <td>Query Arguments</td>
    <td>
      <table class="table table-condensed">
        <tr>
          <th></th>
          <th>Required</th>
          <th>Description</th>
        </tr>
        <tr>
          <td><code>start</code></td>
          <td>No</td>
          <td>Results cursor position</td>
        </tr>
        <tr>
          <td><code>limit</code></td>
          <td>No</td>
          <td>Result window size</td>
        </tr>
      </table>
    </td>
  </tr>
  <tr>
    <td>Response Status</td>
    <td><code>200 OK</code></td>
  </tr>
  <tr>
    <td>Response Entity</td>
    <td>JSON object</td>
  </tr>
</table>
