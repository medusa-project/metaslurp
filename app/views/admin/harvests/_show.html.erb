<div class="row">
  <div class="col-sm-4">
    <dl>
      <dt>Content Service</dt>
      <dd>
        <%= link_to(admin_content_service_path(@harvest.content_service)) do %>
          <%= icon_for(@harvest.content_service) %>
          <%= @harvest.content_service.name %>
        <% end %>
      </dd>
      <dt>Triggered By</dt>
      <dd>
        <%= link_to(admin_user_path(@harvest.user)) do %>
          <%= icon_for(@harvest.user) %> <%= @harvest.user %>
        <% end %>
      </dd>
      <dt>Key</dt>
      <dd><code><%= @harvest.key %></code></dd>
      <dt>Created</dt>
      <dd><%= local_time @harvest.created_at %></dd>
      <dt>Last Updated</dt>
      <dd>
        <% if Time.now - @harvest.updated_at > 1.hour %>
          <%= local_time @harvest.updated_at %>
        <% else %>
          <%= local_time_ago @harvest.updated_at %>
        <% end %>
      </dd>
    </dl>
  </div>
  <div class="col-sm-4">
    <dl>
      <dt>Status</dt>
      <dd><%= harvest_status_badge @harvest.status %></dd>
      <dt>Progress</dt>
      <dd><%= (@harvest.progress * 100).round(1).to_s + '%' %></dd>
      <dt>Run Time</dt>
      <dd><%= distance_of_time_in_words(@harvest.created_at,
                                        @harvest.ended_at || Time.zone.now) %></dd>
      <% if @harvest.usable? %>
        <dt>ETA</dt>
        <dd><%= time_ago_in_words(@harvest.estimated_completion) %></dd>
      <% end %>
      <dt>Items Per Minute</dt>
      <dd><%= number_with_delimiter((@harvest.items_per_second * 60).round) %></dd>
    </dl>
  </div>
  <div class="col-sm-4">
    <dl>
      <dt>Type</dt>
      <dd><%= @harvest.incremental ?
                  raw("Incremental since #{local_time(@harvest.content_service.last_completed_harvest&.created_at)}") :
                  'Full' %></dd>
      <dt>Total Items To Harvest</dt>
      <dd><%= number_with_delimiter(@harvest.num_items) %></dd>
      <dt>Succeeded Items</dt>
      <dd>
        <% if @harvest.num_succeeded > 0 %>
          <span class="badge badge-pill badge-success">
            <%= number_with_delimiter(@harvest.num_succeeded) %></span>
        <% else %>
          <span class="badge badge-pill badge-light">0</span>
        <% end %>
      </dd>
      <dt>Failed Items</dt>
      <dd>
        <% if @harvest.num_failed > 0 %>
          <span class="badge badge-pill badge-danger">
            <%= number_with_delimiter(@harvest.num_failed) %></span>
        <% else %>
          <span class="badge badge-pill badge-light">0</span>
        <% end %>
      </dd>
    </dl>
  </div>
</div>

<% if @harvest.message.present? %>
  <hr>
  <h2>Harvester Messages</h2>
  <pre><%= @harvest.message %></pre>
<% end %>