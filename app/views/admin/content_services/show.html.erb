<% provide :title, @content_service %>
<% provide :active_nav, 'entities' %>

<%= breadcrumb({ label: 'Home', url: admin_root_path },
    { label: 'Content Services', url: admin_content_services_path },
    { label: @content_service.name }) %>

<% if current_user.admin? %>
  <div class="btn-group pull-right" role="group">
    <div class="btn-group" role="group">
      <button id="btnGroupDrop1" type="button" class="btn btn-light dropdown-toggle"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Items
      </button>
      <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
        <%= link_to admin_content_service_reindex_path(@content_service),
                    class: 'dropdown-item', method: 'post' do %>
          <i class="fa fa-refresh"></i> Reindex
        <% end %>
        <%= link_to admin_content_service_purge_path(@content_service),
                    class: 'dropdown-item', method: 'post',
                    data: { confirm: 'Are you sure you want to purge all items '\
                    'from this content service? This cannot be undone.' } do %>
          <i class="fa fa-trash"></i> Purge
        <% end %>
      </div>
    </div>
    <%= link_to edit_admin_content_service_path(@content_service),
                type: 'button', class: 'btn btn-light' do %>
      <i class="fa fa-pencil"></i> Edit
    <% end %>
    <%= link_to admin_content_service_path(@content_service),
                type: 'button', class: 'btn btn-danger', method: 'delete',
                data: { confirm: 'Are you sure you want to delete this content '\
                'service? This cannot be undone.' } do %>
      <i class="fa fa-trash"></i> Delete
    <% end %>
  </div>
<% end %>

<h1><%= @content_service.name %></h1>

<div class="row">
  <div class="col-sm-4">
    <dl>
      <dt>URI</dt>
      <dd><%= @content_service.uri.present? ?
                  link_to(@content_service.uri, @content_service.uri) : 'None' %></dd>
      <dt>Key</dt>
      <dd><code><%= @content_service.key %></code></dd>
      <dt>Description</dt>
      <dd><%= @content_service.description.present? ?
                  @content_service.description : 'None' %></dd>
    </dl>
  </div>
  <div class="col-sm-8">
    <% if current_user.admin? %>
      <%= button_bar({ label: 'Clear Element Mappings',
                       icon: 'fa-close',
                       url: admin_content_service_element_mappings_path(@content_service),
                       method: 'delete',
                       class: 'btn-danger btn-sm',
                       confirm: 'Are you sure you want to clear the element mappings?' }) %>
    <% end %>

    <h2>Element Mappings</h2>

    <div class="alert alert-info">
      <ul>
        <li>To detect new source elements, reindex the service.</li>
        <li>To remove obsolete source elements, clear the mappings and reindex.</li>
        <li>After changing element mappings, the service must be reindexed.</li>
      </ul>
    </div>

    <table class="table table-striped">
      <tr>
        <th>Source Element</th>
        <th>Local Element</th>
      </tr>
      <% @content_service.element_mappings.order(:source_name).each do |mapping| %>
        <tr>
          <td><code><%= mapping.source_name %></code></td>
          <td>
            <%= mapping.element_def&.label %>
          </td>
        </tr>
      <% end %>
    </table>
  </div>
</div>
